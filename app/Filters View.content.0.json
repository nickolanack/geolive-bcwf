{
    "type": "WizardScriptElement",
    "config": {
        "name": "My Custom Script",
        "script": "        \n        \n        \n        var div = new Element('div',{\"id\":\"violationType-filter\", \"class\":\"map-filter violations-filter\"});\n          \n            \n            var names=<?php echo json_encode(GetWidget('mobile-app-markers')->getIconsetData()->names); ?>;\n            var icons=<?php echo json_encode(GetWidget('mobile-app-markers')->getIconsetData()->icons); ?>;\n            \n            var iconSelection = new UIIconizedSelectionControl(div, {\n              allowMultipleSelection: true,\n              allowEmptySelection: true,\n              icons: icons\n              \n            });\n            \n            \n            iconSelection.addEvent('loadIcon', function(icon, i, asset) {\n              new UIPopover(asset.parentNode, {\n                description: \"click to filter map on type: \"+names[i].capitalize(),\n                anchor: UIPopover.AnchorTo(['bottom'])\n              });\n              \n              asset.parentNode.setAttribute('data-type', names[i].capitalize())\n            }); \n            \n            var filterManager=application.getContentFilterManager();\n            var applyFilter=function(values){\n                filterManager.search(\n                    map.getContentFilterManager().setDefaultJoin('or').makeFilter(\"rappAttributes\", values.map(function(v) {\n                          return {\n                            field: \"violationType\",\n                            comparator: 'equalTo',\n                            value: v\n                          };\n                        })\n                      )\n                      );\n                      \n            };\n            \n            iconSelection.addEvent('selectionChanged', function(selection) {\n\n             \/\/  if(selection.length===0){\n             \/\/    me.filterManager.clear(true);\n             \/\/    return;\n             \/\/  }\n            \/\/selection is like: [[stringurl:\"uploads-bcwf.geoforms.ca\/components\/com_geolive\/users_files\/....png\", int:index, element:img]]\n              applyFilter(selection.map(function(a) {\n                return names[icons.indexOf(a[0])];\n              }))\n            });\n\n            \n\n            filterManager.addEvent('clear',function(){\n              iconSelection.clearSelection();\n            });\n\n            filterManager.addEvent('filter',function(){\n              \/*selection=[];\n              attributes.map(function(value){\n                  var valueIsSet=filterManager.isFilteringOnFieldValue(field, value)\n                  if(valueIsSet){\n\n                  }else{\n\n                  }\n              });\n              *\/\n\n            });\n            \n            \n            \n            return div;",
        "description": "Info about my custom script"
    }
}